<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Sonic</title>
  <style>
    body { margin:0; overflow:hidden; }
    canvas {
      background: linear-gradient(#87CEEB, #1E90FF);
      display:block; margin:0 auto;
    }
    /* Botones de menú e información */
    .game-buttons {
      background-color:#ffffff;
      color:#e74c3c;
      font-weight:bold;
      text-decoration:none;
      padding:10px 20px;
      border-radius:5px;
      position:absolute;
      top:10px;
      z-index:10;
    }
    .menu-button { right:10px; }
    .help-button { left:10px; }
  </style>
</head>
<body>
  <a href="./index.html" class="menu-button game-buttons">Menu</a>
  <a href="./help.html" class="help-button game-buttons">Info</a>
  <canvas id="game" width="800" height="400"></canvas>
  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const keys = { left:false, right:false };
    const gravity = 0.6;
    const player = {
      x:50, y:300, w:40, h:40,
      vx:0, vy:0,
      speed:3.5, jump:12,
      onGround:false
    };
    const level = { width:2000, height:canvas.height, ground:80 };
    const coins = [];
    for(let i=200;i<level.width-200;i+=200){
      coins.push({x:i, y:level.height-level.ground-40, r:15, collected:false});
    }
    const goal = { x:level.width-100, y:level.height-level.ground-50, w:40, h:40, pressed:false };
    let cameraX = 0;

    // Crear textura de suelo
    const groundCanvas = document.createElement('canvas');
    groundCanvas.width = groundCanvas.height = 40;
    const gctx = groundCanvas.getContext('2d');
    gctx.fillStyle = '#228B22';
    gctx.fillRect(0,0,40,20);
    gctx.fillStyle = '#006400';
    gctx.fillRect(0,20,40,20);
    const groundPattern = ctx.createPattern(groundCanvas, 'repeat');

    document.addEventListener('keydown', e => {
      if(e.code === 'ArrowLeft') keys.left = true;
      if(e.code === 'ArrowRight') keys.right = true;
      if((e.code === 'ArrowUp' || e.code === 'Space') && player.onGround){
        player.vy = -player.jump;
        player.onGround = false;
      }
    });
    document.addEventListener('keyup', e => {
      if(e.code === 'ArrowLeft') keys.left = false;
      if(e.code === 'ArrowRight') keys.right = false;
    });

    function allCoins(){
      return coins.every(c => c.collected);
    }

    function update(){
      player.vx = 0;
      if(keys.left) player.vx = -player.speed;
      if(keys.right) player.vx = player.speed;
      player.vy += gravity;
      player.x += player.vx;
      player.y += player.vy;

      if(player.y + player.h > level.height - level.ground){
        player.y = level.height - level.ground - player.h;
        player.vy = 0;
        player.onGround = true;
      }
      if(player.x < 0) player.x = 0;
      if(player.x + player.w > level.width) player.x = level.width - player.w;

      coins.forEach(c => {
        const dx = player.x + player.w/2 - c.x;
        const dy = player.y + player.h/2 - c.y;
        if(!c.collected && Math.hypot(dx,dy) < c.r + player.w/2){
          c.collected = true;
        }
      });

      if(allCoins() &&
         player.x + player.w > goal.x && player.x < goal.x + goal.w &&
         player.y + player.h > goal.y && player.y < goal.y + goal.h){
        goal.pressed = true;
      }

      cameraX = player.x - canvas.width/2;
      cameraX = Math.max(0, Math.min(cameraX, level.width - canvas.width));
    }

    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.save();
      ctx.translate(-cameraX,0);
      ctx.fillStyle = groundPattern;
      ctx.fillRect(0, level.height - level.ground, level.width, level.ground);
      coins.forEach(c => {
        if(!c.collected){
          ctx.beginPath();
          ctx.arc(c.x, c.y, c.r, 0, Math.PI*2);
          ctx.fillStyle = 'gold';
          ctx.fill();
          ctx.strokeStyle = '#cc0';
          ctx.stroke();
        }
      });
      ctx.fillStyle = goal.pressed ? '#0f0' : '#f00';
      ctx.fillRect(goal.x, goal.y, goal.w, goal.h);
      ctx.fillStyle = 'blue';
      ctx.fillRect(player.x, player.y, player.w, player.h);
      ctx.restore();
      if(goal.pressed){
        ctx.fillStyle = '#fff';
        ctx.font = '24px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('¡Has ganado!', canvas.width/2, canvas.height/2);
      }
    }

    function loop(){
      update();
      draw();
      requestAnimationFrame(loop);
    }
    loop();
  </script>
</body>
</html>
