<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Irregular Verbs ¬∑ Trainer</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background:#0f172a;
      color:#e5e7eb;
      display:flex;
      justify-content:center;
      align-items:center;
      min-height:100vh;
      padding: 16px;
    }
    .app {
      background:#1e293b;
      padding:24px;
      border-radius:16px;
      max-width:750px;
      width:100%;
      box-shadow:0 10px 40px rgba(0,0,0,0.4);
      text-align:center;
    }
    h1 { font-size:22px; margin:0 0 8px; }
    p { color:#9ca3af; font-size:14px; margin:0 0 20px; }
    .infinitive { font-size:40px; font-weight:700; margin:20px 0; }

    .inputs { display:grid; gap:10px; margin-bottom: 8px; }
    .field { text-align:left; }
    .field label { font-size:13px; color:#9ca3af; display:block; margin-bottom:4px; }

    input {
      width:100%;
      padding:10px;
      border-radius:8px;
      border:1px solid #334155;
      background:#0f172a;
      color:white;
      font-size:16px;
      outline: none;
      pointer-events: auto;
      user-select: text;
    }
    input:focus { border-color:#60a5fa; }

    button {
      margin-top:10px;
      padding:10px 16px;
      border:none;
      border-radius:8px;
      background:#3b82f6;
      color:white;
      font-weight:600;
      cursor:pointer;
    }

    .feedback { margin-top:10px; min-height:20px; }
    .ok { color:#22c55e; }
    .bad { color:#ef4444; }
    .stats { margin-top:15px; font-size:16px; color:#9ca3af; }
    .stats span { margin:0 10px; }

    .list-controls { margin-top:15px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap; }
    .list-display { margin-top:10px; font-size:14px; color:#e5e7eb; min-height:20px; text-align:left; max-height:260px; overflow:auto; display:none; }

    .verb-table { width:100%; border-collapse:collapse; font-size:13px; margin-top:8px; }
    .verb-table th, .verb-table td { border:1px solid #334155; padding:4px 6px; }
    .verb-table th { background:#111827; position:sticky; top:0; }
  </style>
</head>
<body>
  <div class="app">
    <h1>Irregular Verbs Trainer</h1>
    <p>Write the past simple, past participle and the Catalan translation.</p>

    <div class="infinitive" id="verb">go</div>

    <div class="inputs">
      <div class="field">
        <label for="past">Past Simple</label>
        <input type="text" id="past" placeholder="did / went / ate..." autocomplete="off" />
      </div>
      <div class="field">
        <label for="ppart">Past Participle</label>
        <input type="text" id="ppart" placeholder="done / gone / eaten..." autocomplete="off" />
      </div>
      <div class="field">
        <label for="catalan">Catal√†</label>
        <input type="text" id="catalan" placeholder="fer / anar / menjar..." autocomplete="off" />
      </div>
    </div>

    <button id="check" type="button">Check</button>
    <div class="feedback" id="feedback"></div>

    <div class="stats">
      ‚úÖ Correct: <span id="correctCount">0</span>
      ‚ùå Wrong: <span id="wrongCount">0</span>
    </div>

    <div class="list-controls">
      <button id="showList" type="button">Llista</button>
      <button id="practiceList" type="button">Practicar llista</button>
    </div>
    <div id="listDisplay" class="list-display"></div>
  </div>

  <script>
    const verbs = [
      { base:'be',past:['was','were'],ppart:['been'],ca:['ser','estar']},
      { base:'beat',past:['beat'],ppart:['beaten'],ca:['colpejar','batre']},
      { base:'become',past:['became'],ppart:['become'],ca:['convertir-se']},
      { base:'begin',past:['began'],ppart:['begun'],ca:['comen√ßar']},
      { base:'bend',past:['bent'],ppart:['bent'],ca:['doblegar']},
      { base:'bet',past:['bet'],ppart:['bet'],ca:['apostar']},
      { base:'bite',past:['bit'],ppart:['bitten'],ca:['mossegar']},
      { base:'bleed',past:['bled'],ppart:['bled'],ca:['sagnar']},
      { base:'blow',past:['blew'],ppart:['blown'],ca:['bufar']},
      { base:'break',past:['broke'],ppart:['broken'],ca:['trencar']},
      { base:'bring',past:['brought'],ppart:['brought'],ca:['portar']},
      { base:'build',past:['built'],ppart:['built'],ca:['construir']},
      { base:'burn',past:['burnt','burned'],ppart:['burnt','burned'],ca:['cremar']},
      { base:'buy',past:['bought'],ppart:['bought'],ca:['comprar']},
      { base:'catch',past:['caught'],ppart:['caught'],ca:['atrapar','agafar']},
      { base:'choose',past:['chose'],ppart:['chosen'],ca:['escollir','triar']},
      { base:'come',past:['came'],ppart:['come'],ca:['venir']},
      { base:'cost',past:['cost'],ppart:['cost'],ca:['costar']},
      { base:'cut',past:['cut'],ppart:['cut'],ca:['tallar']},
      { base:'dig',past:['dug'],ppart:['dug'],ca:['cavar']},
      { base:'do',past:['did'],ppart:['done'],ca:['fer']},
      { base:'draw',past:['drew'],ppart:['drawn'],ca:['dibuixar']},
      { base:'dream',past:['dreamt','dreamed'],ppart:['dreamt','dreamed'],ca:['somiar']},
      { base:'drink',past:['drank'],ppart:['drunk'],ca:['beure']},
      { base:'drive',past:['drove'],ppart:['driven'],ca:['conduir']},
      { base:'eat',past:['ate'],ppart:['eaten'],ca:['menjar']},
      { base:'fall',past:['fell'],ppart:['fallen'],ca:['caure']},
      { base:'feed',past:['fed'],ppart:['fed'],ca:['alimentar']},
      { base:'feel',past:['felt'],ppart:['felt'],ca:['sentir']},
      { base:'fight',past:['fought'],ppart:['fought'],ca:['lluitar']},
      { base:'find',past:['found'],ppart:['found'],ca:['trobar']},
      { base:'fly',past:['flew'],ppart:['flown'],ca:['volar']},
      { base:'forget',past:['forgot'],ppart:['forgotten'],ca:['oblidar']},
      { base:'forgive',past:['forgave'],ppart:['forgiven'],ca:['perdonar']},
      { base:'freeze',past:['froze'],ppart:['frozen'],ca:['congelar']},
      { base:'get',past:['got'],ppart:['got'],ca:['obtenir','aconseguir']},
      { base:'give',past:['gave'],ppart:['given'],ca:['donar']},
      { base:'go',past:['went'],ppart:['gone'],ca:['anar']},
      { base:'grow',past:['grew'],ppart:['grown'],ca:['cr√©ixer','creixer']},
      { base:'hang',past:['hung','hanged'],ppart:['hung','hanged'],ca:['penjar']},
      { base:'have',past:['had'],ppart:['had'],ca:['tenir']},
      { base:'hear',past:['heard'],ppart:['heard'],ca:['sentir','escoltar']},
      { base:'hide',past:['hid'],ppart:['hidden'],ca:['amagar']},
      { base:'hit',past:['hit'],ppart:['hit'],ca:['colpejar']},
      { base:'hold',past:['held'],ppart:['held'],ca:['aguantar','subjectar']},
      { base:'hurt',past:['hurt'],ppart:['hurt'],ca:['fer mal']},
      { base:'keep',past:['kept'],ppart:['kept'],ca:['guardar','mantenir']},
      { base:'know',past:['knew'],ppart:['known'],ca:['saber','con√®ixer','coneixer']},
      { base:'lay',past:['laid'],ppart:['laid'],ca:['posar','estirar']},
      { base:'lead',past:['led'],ppart:['led'],ca:['guiar','liderar']},
      { base:'learn',past:['learnt','learned'],ppart:['learnt','learned'],ca:['aprendre']},
      { base:'leave',past:['left'],ppart:['left'],ca:['deixar','abandonar']},
    ];

    let current;
    let correct = 0;
    let wrong = 0;
    let failedOnce = false;

    let difficultVerbs = [];
    let useListOnly = false;

    function updateStats(){
      document.getElementById('correctCount').textContent = correct;
      document.getElementById('wrongCount').textContent = wrong;
    }

    function normalize(str){
      return (str || '')
        .toLowerCase()
        .trim()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "");
    }

    function getPool(){
      if (useListOnly && difficultVerbs.length > 0) {
        return verbs.filter(v => difficultVerbs.includes(v.base));
      }
      return verbs;
    }

    function newVerb(){
      const pool = getPool();
      current = pool[Math.floor(Math.random()*pool.length)];

      document.getElementById('verb').textContent = current.base;
      document.getElementById('past').value = '';
      document.getElementById('ppart').value = '';
      document.getElementById('catalan').value = '';
      document.getElementById('feedback').textContent = '';
      failedOnce = false;

      // IMPORTANTE: poner foco para poder escribir
      document.getElementById('past').focus();
    }

    function addToDifficultList(verbBase){
      if (!difficultVerbs.includes(verbBase)) difficultVerbs.push(verbBase);
    }

    function check(){
      const fb = document.getElementById('feedback');

      const valPast  = normalize(document.getElementById('past').value);
      const valPpart = normalize(document.getElementById('ppart').value);
      const valCa    = normalize(document.getElementById('catalan').value);

      const pastOk  = current.past.some(p => normalize(p) === valPast);
      const ppartOk = current.ppart.some(p => normalize(p) === valPpart);
      const caOk    = current.ca.some(c => normalize(c) === valCa);

      if (pastOk && ppartOk && caOk) {
        if (!failedOnce) correct++;
        updateStats();
        fb.innerHTML = `<span class='ok'>‚úÖ Correct!</span>`;
        setTimeout(newVerb, 700);
      } else {
        wrong++;
        failedOnce = true;
        updateStats();
        addToDifficultList(current.base);
        fb.innerHTML = `<span class='bad'>‚ùå Incorrect. Try again.</span>`;
      }
    }

    document.getElementById('check').addEventListener('click', check);

    ['past','ppart','catalan'].forEach(id => {
      document.getElementById(id).addEventListener('keydown', e => {
        if (e.key === 'Enter') check();
      });
    });

    document.getElementById('showList').addEventListener('click', () => {
      const div = document.getElementById('listDisplay');

      if (div.style.display === 'block') {
        div.style.display = 'none';
        div.innerHTML = '';
        return;
      }

      div.style.display = 'block';

      let html = '<strong>Taula de tots els verbs:</strong>';
      html += '<table class="verb-table">';
      html += '<thead><tr><th>Infinitive</th><th>Past Simple</th><th>Past Participle</th><th>Catal√†</th></tr></thead><tbody>';

      verbs.forEach(v => {
        html += `<tr>
          <td>${v.base}</td>
          <td>${v.past.join(' / ')}</td>
          <td>${v.ppart.join(' / ')}</td>
          <td>${v.ca.join(' / ')}</td>
        </tr>`;
      });

      html += '</tbody></table>';

      if (difficultVerbs.length > 0) {
        html += `<p><strong>Verbs per practicar:</strong> ${difficultVerbs.join(', ')}</p>`;
      } else {
        html += `<p><em>Encara no hi ha verbs marcats com a dif√≠cils.</em></p>`;
      }

      div.innerHTML = html;
    });

    document.getElementById('practiceList').addEventListener('click', (e) => {
      const btn = e.target;

      if (!useListOnly) {
        if (difficultVerbs.length === 0) {
          const div = document.getElementById('listDisplay');
          div.style.display = 'block';
          div.innerHTML = '<em>No hi ha verbs a la llista encara. Falla algun verb i s\'afegir√† aqu√≠ üòâ</em>';
          return;
        }
        useListOnly = true;
        btn.textContent = 'Practicar tots';
      } else {
        useListOnly = false;
        btn.textContent = 'Practicar llista';
      }
      newVerb();
    });

    // Iniciar
    newVerb();
  </script>
</body>
</html>
